components:

  parameters:
    trustDomainId:
      name: trustDomainId
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/TrustDomainId"
      description: ID of the Trust Domain

  schemas:
    TrustDomainId:
      type: string
      minLength: 1
      maxLength: 64
      description: The unique identifier for the trust domain.
      example: "wifi-1"

    TrustDomainUpdate:
      type: object
      description: Represents the updatable fields of a trust domain within the network access management system.
      properties:
        name:
          type: string
          description: Human-readable name for the trust domain.
          example: "Primary WiFi Network"
        description:
          type: string
          description: Detailed description of the trust domain.
          example: "Primary home WiFi Network for all devices"
        enabled:
          type: boolean
          description: Indicates whether the trust domain is currently enabled.
          example: true
        expiration:
          $ref: "./Common.yaml#/components/schemas/DateTime"
          description: |
            The expiration date and time of the network.  It must follow [RFC 3339](https://datatracker.ietf.org/doc/html/rfc3339#section-5.6)
            and must have time zone. Recommended format is yyyy-MM-dd'T'HH:mm:ss.SSSZ (i.e. which allows
            2023-07-03T14:27:08.312+02:00 or 2023-07-03T12:27:08.312Z).

            If omitted, the trust domain will not automatically expire.
        policies:
          type: array
          description: An optional list of policies associated with the trust domain.
          items:
            $ref: "#/components/schemas/Policy"
        accessDetails:
          type: array
          description: An optional list of access details for the trust domain.
          items:
            $ref: "#/components/schemas/AccessDetail"
          minItems: 1

    TrustDomainCreate:
      allOf:
        - $ref: "#/components/schemas/TrustDomainUpdate"
      description: Represents the creation of a new trust domain within the network access management system.
      required:
        - name
        - enabled
        - accessDetails

    TrustDomain:
      allOf:
        - $ref: "#/components/schemas/TrustDomainUpdate"
        - properties:
            id:
              $ref: "#/components/schemas/TrustDomainId"
            createdAt:
              allOf:
                - $ref: "./Common.yaml#/components/schemas/DateTime"
                - description: |
                    The creation date and time of the trust domain.  It must follow [RFC 3339](https://datatracker.ietf.org/doc/html/rfc3339#section-5.6)
                    and must have time zone. Recommended format is yyyy-MM-dd'T'HH:mm:ss.SSSZ (i.e. which allows
                    2023-07-03T14:27:08.312+02:00 or 2023-07-03T12:27:08.312Z).
            createdBy:
              type: string
              maxLength: 100
              description: The user who created the network
              example: "user-1"
            modifiedAt:
              allOf:
                - $ref: "./Common.yaml#/components/schemas/DateTime"
                - description: |
                    The last update date and time of the trust domain.  It must follow [RFC 3339](https://datatracker.ietf.org/doc/html/rfc3339#section-5.6)
                    and must have time zone. Recommended format is yyyy-MM-dd'T'HH:mm:ss.SSSZ (i.e. which allows
                    2023-07-03T14:27:08.312+02:00 or 2023-07-03T12:27:08.312Z).
            modifiedBy:
              type: string
              maxLength: 100
              description: The user who last updated the trust domain
              example: "user-2"
          required:
            - id
      additionalProperties: false
      description: Represents a trust domain within the network access management system.

    ActivePeriod:
      type: object
      description: Defines when a policy is active.
      properties:
        start:
          $ref: "./Common.yaml#/components/schemas/DateTime"
        end:
          $ref: "./Common.yaml#/components/schemas/DateTime"
        duration:
          type: string
          pattern: "^P(?!$)(\\d+D)?(T(\\d+H)?(\\d+M)?(\\d+S)?)?$"
          description: ISO 8601 duration (e.g., P1D = 1 day, PT12H = 12 hours)
      example:
        start: "2025-10-21T12:00:00Z"
        end: "2025-10-22T12:00:00Z"

    Policy:
      type: object
      required: [type]
      properties:
        type:
          type: string
          enum:
            - maxDevices
            - maxDomainDownstreamKbps
            - maxDomainUpstreamKbps
            - egressAllowedList
          description: The policy type discriminator.
        activePeriod:
          $ref: "#/components/schemas/ActivePeriod"
        metadata:
          type: object
          additionalProperties: true
          description: Optional operator- or implementation-specific extensions.
        # value:
        #   description: The type-specific policy value.
      discriminator:
        propertyName: type
        mapping:
          maxDevices: "#/components/schemas/MaxDevicesPolicy"
          maxDomainDownstreamKbps: "#/components/schemas/MaxDomainDownstreamKbpsPolicy"
          maxDomainUpstreamKbps: "#/components/schemas/MaxDomainUpstreamKbpsPolicy"
          egressAllowedList: "#/components/schemas/EgressAllowedListPolicy"

    MaxDevicesPolicy:
      allOf:
        - $ref: '#/components/schemas/Policy'
        - type: object
          properties:
            value:
              type: integer
              minimum: 1
              example: 10
          description: Limits the number of devices that may join the Trust Domain.
          example: &max-devices-policy
            type: maxDevices
            value: 10
      additionalProperties: false

    MaxDomainDownstreamKbpsPolicy:
      allOf:
        - $ref: '#/components/schemas/Policy'
        - type: object
          properties:
            value:
              type: integer
              example: 50000
          description: Defines the aggregate maximum downstream throughput (Kbps) across all devices in the domain.
          example: &max-domain-downstream-kbps-policy
            type: maxDomainDownstreamKbps
            value: 50000
      additionalProperties: false

    MaxDomainUpstreamKbpsPolicy:
      allOf:
        - $ref: '#/components/schemas/Policy'
        - type: object
          properties:
            value:
              type: integer
              example: 10000
          description: Defines the aggregate maximum upstream throughput (Kbps) across all devices in the domain.
          example: &max-domain-upstream-kbps-policy
            type: maxDomainUpstreamKbps
            value: 10000
      additionalProperties: false

    EgressAllowedListPolicy:
      allOf:
        - $ref: '#/components/schemas/Policy'
        - type: object
          properties:
            value:
              type: array
              items:
                type: string
                description: FQDN or CIDR pattern.
                example: "api.vendor.com"
              minItems: 1
          description: Restricts egress traffic to the specified destinations.
          example: &egress-allowed-list-policy
            type: egressAllowedList
            value:
              - "api.vendor.com"
              - "updates.vendor.com"
      additionalProperties: false

    WpaPersonalDetail:
      type: object
      properties:
        password:
          type: string
          maxLength: 255
          description: The password for the WPA Personal Wi-Fi network
          example: &wpa-personal-password "my-password"
        securityModeType:
          type: string
          enum:
            - WPA2-Personal
            - WPA2-WPA3-Personal
            - WPA3-Personal
          description: |
            The security mode type for the WPA Personal Wi-Fi network.
            Leave blank to auto-select.
          example: &wpa-personal-security-mode-type "WPA3-Personal"
      required:
        - password
      example: &wpa-personal
        password: *wpa-personal-password
        securityModeType: *wpa-personal-security-mode-type

    WpaEnterpriseDetail:
      type: object
      properties:
        authServer:
          type: string
          maxLength: 255
          description: The authentication server for the WPA Enterprise Wi-Fi network
          example: &wpa-enterprise-auth-server "1.2.3.4"
        securityModeType:
          type: string
          enum:
            - WPA2-Enterprise
            - WPA3-Enterprise
          description: The security mode type for the WPA Enterprise Wi-Fi network
          example: &wpa-enterprise-security-mode-type "WPA3-Enterprise"
      required:
        - securityModeType
      example: &wpa-enterprise
        authServer: *wpa-enterprise-auth-server
        securityModeType: *wpa-enterprise-security-mode-type

    WiFiAccessDetail:
      type: object
      properties:
        accessType:
          type: string
          enum:
            - Wi-Fi
          example: &wifi-access-detail-access-type "Wi-Fi"
        ssid:
          type: string
          minLength: 2
          maxLength: 32
          description: The SSID (network name) of the Wi-Fi network
          example: &wifi-access-detail-ssid "my-ssid"
        securityMode:
          oneOf:
            - $ref: "#/components/schemas/WpaPersonalDetail"
            - $ref: "#/components/schemas/WpaEnterpriseDetail"
          discriminator:
            propertyName: securityModeType
            mapping:
              WPA2-Personal: "#/components/schemas/WpaPersonalDetail"
              WPA2-WPA3-Personal: "#/components/schemas/WpaPersonalDetail"
              WPA3-Personal: "#/components/schemas/WpaPersonalDetail"
              WPA2-Enterprise: "#/components/schemas/WpaEnterpriseDetail"
              WPA3-Enterprise: "#/components/schemas/WpaEnterpriseDetail"
          description: The security mode details for the Wi-Fi network
          example: *wpa-personal
      required:
        - accessType
      example: &wifi-access-detail
        accessType: *wifi-access-detail-access-type
        ssid: *wifi-access-detail-ssid
        securityMode: *wpa-personal

    ThreadStructuredAccessDetail:
      type: object
      properties:
        mode:
          type: string
          description: Structured Thread access details
          enum:
            - structured
          example: "structured"
        channel:
          type: integer
          minimum: 11
          maximum: 26
          description: The Thread channel (IEEE 802.15.4 channel number)
          example: 13
        extendedPanId:
          type: string
          pattern: "^[0-9a-fA-F]{16}$"
          description: The Extended PAN ID (16 hex digits)
          example: "d63e8e3e495ebbc3"
        networkKey:
          type: string
          pattern: "^[0-9a-fA-F]{32}$"
          description: The Thread Network Key (32 hex digits)
          example: "dfd34f0f05cad978ec4e32b0413038ff"
        networkName:
          type: string
          minLength: 1
          maxLength: 16
          description: The Thread Network Name (1-16 ASCII characters)
          example: "Spec-Thread-B3AF"
        panId:
          type: string
          pattern: "^[0-9a-fA-F]{4}$"
          description: The PAN ID (4 hex digits)
          example: "d63e"
      required:
        - mode
        - channel
        - extendedPanId
        - networkKey
        - networkName
        - panId
      example: &thread-structured-access-detail
        mode: "structured"
        channel: 13
        extendedPanId: "d63e8e3e495ebbc3"
        networkKey: "dfd34f0f05cad978ec4e32b0413038ff"
        networkName: "Spec-Thread-B3AF"
        panId: "d63e"

    ThreadTlvAccessDetail:
      type: object
      properties:
        mode:
          type: string
          description: TLV encoded Thread operational dataset
          enum:
            - tlv
          example: "tlv"
        operationalDataset:
          type: string
          maxLength: 255
          description: The Thread network credentials (operational dataset) encoded as a TLV hex string
          example: "0e08000000000000010010000102030405060708090a0b0c0d0e0f"
      required:
        - mode
        - operationalDataset
      example: &thread-tlv-access-detail
        mode: tlv
        operationalDataset: "0e08000000000000010010000102030405060708090a0b0c0d0e0f"

    ThreadAccessDetail:
      type: object
      properties:
        accessType:
          type: string
          enum:
            - Thread
          example: "Thread"
      oneOf:
        - $ref: "#/components/schemas/ThreadStructuredAccessDetail"
        - $ref: "#/components/schemas/ThreadTlvAccessDetail"
      discriminator:
        propertyName: mode
        mapping:
          structured: "#/components/schemas/ThreadStructuredAccessDetail"
          tlv: "#/components/schemas/ThreadTlvAccessDetail"
      description: The Thread network details, either structured or TLV encoded
      required:
        - accessType
        - mode
      example: &thread-access-detail
        accessType: "Thread"
        mode: "structured"
        channel: 13
        extendedPanId: "d63e8e3e495ebbc3"
        networkKey: "dfd34f0f05cad978ec4e32b0413038ff"
        networkName: "Spec-Thread-B3AF"
        panId: "d63e"

    AccessDetail:
      oneOf:
        - $ref: "#/components/schemas/WiFiAccessDetail"
        - $ref: "#/components/schemas/ThreadAccessDetail"
      discriminator:
        propertyName: accessType
        mapping:
          Wi-Fi: "#/components/schemas/WiFiAccessDetail"
          Thread: "#/components/schemas/ThreadAccessDetail"
      example: *wifi-access-detail

  examples:

    WifiAccessDetailWPA2PersonalBasic: &wifi-wpa2-personal-basic
      accessType: "Wi-Fi"
      securityMode:
        password: "my-password"
        securityModeType: "WPA2-Personal"

    WifiAccessDetailWPA2Personal: &wifi-wpa2-personal
      accessType: "Wi-Fi"
      ssid: "my-ssid"
      securityMode:
        password: "my-password"
        securityModeType: "WPA2-Personal"

    WifiAccessDetailWPA3Personal: &wifi-wpa3-personal
      <<: *wifi-access-detail

    ThreadAccessDetailStructured: &thread-structured
      accessType: "Thread"
      <<: *thread-structured-access-detail

    # All examples below are example objects (summary + value) for use in API definitions. Pure JSON object aliases should go above.

    TrustDomainCreateWpa2Personal:
      summary: Create a Trust Domain with WPA2-Personal Wi-Fi access.
      value:
        name: "Primary WiFi Network"
        description: "Request defines a Trust Domain with WPA2-Personal Wi-Fi access. The request specifies an SSID, implying the SSID is created on the network infrastructure."
        enabled: true
        accessDetails:
          - <<: *wifi-wpa2-personal

    TrustDomainCreateInferredSsid:
      summary: Create a Trust Domain with inferred SSID Wi-Fi access.
      value:
        name: "Inferred SSID Network"
        description: "Request defines a Trust Domain with inferred SSID Wi-Fi access. The request omits the SSID, implying the Trust Domain is applied to an existing SSID on the network infrastructure."
        enabled: true
        accessDetails:
          - accessType: "Wi-Fi"
            securityMode:
              password: "my-password"
              securityModeType: "WPA2-Personal"

    TrustDomainCreateEphemeral:
      summary: Create a Trust Domain with ephemeral access details.
      value:
        name: "Ephemeral Network"
        description: "Request defines a Trust Domain with ephemeral access details."
        enabled: true
        accessDetails:
          - <<: *wifi-wpa3-personal
        expiration: "2024-12-31T23:59:59Z"
        policies:
          - *max-devices-policy

    TrustDomainCreateThreadStructured:
      summary: Create a Trust Domain with Thread structured access details.
      value:
        name: "Thread Structured Network"
        description: "Request defines a Trust Domain with Thread structured access details."
        enabled: true
        accessDetails:
          - <<: *thread-structured

    TrustDomainCreateQoSPolicies:
      summary: Create a Trust Domain with QoS policies.
      value:
        name: "QoS Policy Network"
        description: "Request defines a Trust Domain with QoS policies."
        enabled: true
        accessDetails:
          - <<: *wifi-wpa3-personal
        policies:
          - *max-domain-downstream-kbps-policy
          - *max-domain-upstream-kbps-policy

    TrustDomainResponseBasic:
      summary: Basic Trust Domain Response
      description: Example of a created Trust Domain with minimal details.
      value:
        id: "trustdomain-123"
        name: "Basic Trust Domain"
        description: "A basic trust domain example"
        enabled: true
        accessDetails:
          - <<: *wifi-wpa2-personal-basic
        createdAt: "2025-10-21T14:27:08.312Z"
        createdBy: "user-1"
        modifiedAt: "2025-10-21T14:27:08.312Z"
        modifiedBy: "user-1"

    TrustDomainResponseWiFiThread:
      summary: Created Trust Domain (Wi-Fi + Thread)
      description: Example of a created Trust Domain including Wi-Fi and Thread access details and populated policies.
      value:
        id: "wifi-1"
        name: "Primary WiFi Network"
        description: "Primary home Wi-Fi Network for all devices"
        enabled: true
        expiration: "2025-10-21T14:27:08.312Z"
        policies:
          - <<: *max-devices-policy
          - <<: *egress-allowed-list-policy
        accessDetails:
          - <<: *wifi-wpa3-personal
          - <<: *thread-structured
        createdAt: "2025-10-21T14:27:08.312Z"
        createdBy: "user-1"
        modifiedAt: "2025-10-21T14:27:08.312Z"
        modifiedBy: "user-2"