openapi: 3.0.3

info:
  title: Home Devices - Network Access Management
  description: |
    Service enabling API for managing network operator supplied network access devices. This APIs initial focus is on
    managing **Trust Domains** and device reboot requests.

    # Introduction
    A Trust Domain is a network access configuration where each configuration is for a logically separated Local
    Area Network (LAN). API consumers can create, modify, or remove these networks which could be useful in
    scenarios such as:

    - A property owner wants to create a temporary network for the duration of a short-term booking or long-term rental.
    - A property manager wants to replicate the network access details across multiple network access devices at one or
      more locations such as common areas, offices, etc.
    - A security/privacy-minded user wants to create one or more networks for their guests or Internet-of-Thing (IoT)
      network clients.

    A reboot request is simply a request to reboot a network operator supplied network access device. API consumers
    can create these requests which could be useful in scenarios such as:

    - A property owner wants to recover from a faulty network state by rebooting a gateway device.
    - A property manager wants to reboot multiple devices at one or more locations such as common areas, offices, etc.

    # Relevant Terms and Definitions
    - **Trust Domain**: a declarative, intent-level grouping that defines which devices are permitted to communicate with each other as if they were on the same LAN and what high-level access policies apply to that group.
    - **Reboot Request**: A request to reboot a network operator supplied network access device.
    - **Device**: A network operator supplied network access device that supports network segmentation technologies.  Multiple devices
    that support LAN connectivity across the same Trust Domain (e.g., mesh Wi-Fi, Thread personal area network,
    etc.) SHOULD be presented as a single device for implementations of this API.
    - **API Provider**: Provider that implements this API.
    - **Network Operator**: Service provider that has operational control of supporting devices.
    - **Service Owner**: Customer of a network operator and resource owner with one or more devices that supports this
    API across one or more service sites.
    - **Service Site**: A distinct service owner location, as interpreted by the network operator, with one or more
    devices.  A service site typically has a one-to-one relationship with the mailing address of the location.  Network
    operators that support a single identity or interchangeable identities for multiple service sites at the same
    mailing address (e.g., a residential and business account, an office and common area account, etc.) MUST provide
    some distinction in the property address (e.g., attn: Home Office, attn: Common Area, etc.).  Multiple service
    sites, for the same mailing address, but for unrelated service owner identities, do not have this requirement.
    - **End-User**: The user connecting to a Trust Domain with a network client.
    - **Network Client**: End-user equipment connecting to a Trust Domain (e.g., laptop, phone, IoT device, etc.).
    - **API Client**: A first- or third-party software system using this API.

    # API Functionality
    This API allows API clients to manage Trust Domains and reboot network access devices.

    ### Authorization and authentication

    The "CAMARA Security and Interoperability Profile" provides details of how an API consumer requests an access token. Please refer to Identity and Consent Management (https://github.com/camaraproject/IdentityAndConsentManagement/) for the released version of the profile.

    The specific authorization flows to be used will be agreed upon during the onboarding process, happening between the API consumer and the API provider, taking into account the declared purpose for accessing the API, whilst also being subject to the prevailing legal framework dictated by local legislation.

    In cases where personal data is processed by the API and users can exercise their rights through mechanisms such as opt-in and/or opt-out, the use of three-legged access tokens is mandatory. This ensures that the API remains in compliance with privacy regulations, upholding the principles of transparency and user-centric privacy-by-design.

    ### Scopes
    Scopes are used to protect the service owner's information and privacy.  The general format is
    `<API_name>-<Resource>-<Permission>`.  A resource may be further broken down into `<Resource_name>-<Field>` or
    `<Resource_name>-<Role>` for granular permissions. Scopes also control output information as opposed to just
    authorizing endpoints. Each endpoint definition will clearly state what scopes are needed for access and which are
    needed to access additional information. Below are some general rules for scopes in this API.

    - Regulated information, such as physical locations or hardware addresses of network devices, have special scopes.
    Network operators are expected to follow any local regulations when sharing this information with an API client.
    - Scopes have inheritance when one scope would otherwise require the inherited scope.
    - Read scopes for one resource impacts the output of another resource when the requested resource has a relationship
    with the first (e.g., listing networks on a device requires both device and network read scopes).
    - Trust Domains are broken down into 3 roles allowing service owners to grant granular permissions to API
    clients: only-own, primary, and auxiliary. The primary role allows API clients to manage the main network access
    configuration. The auxiliary role allows API clients to manage all auxiliary (i.e., secondary) networks. The
    only-own role allows API clients to manage networks it has created. Only-own networks SHOULD be an auxiliary, or
    secondary, network. Note that there is an edge case when a service owner revokes the primary role authorization. An
    API client SHOULD be able to continue managing primary Trust Domains created by the client. Complete
    administrative control requires both the primary and auxiliary roles.

    | Scope | Description | Inherits
    |-------|-------------|---------
    | **network-access-management:service-sites:read** | List a service owner's service sites
    | **network-access-management:service-sites.location:read** | Read a service site's physical location | network-access-management:service-sites:read
    | **network-access-management:devices:read** | List a service owner's devices
    | **network-access-management:devices.hardware-address:read** | Read a service owner's device's hardware address | network-access-management:devices:read
    | **network-access-management:devices:write** | Modify which networks are configured on a service owner's devices | network-access-management:devices:read
    | **network-access-management:trust-domains:wifi:read** | List a service owner's Wi-Fi Trust Domains created by the calling API client
    | **network-access-management:trust-domains:wifi:write** | Create or modify a service owner's Wi-Fi Trust Domains created by the calling API client | network-access-management:trust-domains:wifi:read
    | **network-access-management:trust-domains:wifi.primary:read** | Access information about a service owner's Wi-Fi primary trust domain
    | **network-access-management:trust-domains:wifi.primary:write** | Modify a service owner's primary Wi-Fi trust domain | network-access-management:trust-domains:wifi.primary:read
    | **network-access-management:trust-domains:wifi.auxiliary:read** | List a service owner's auxiliary Wi-Fi Trust Domains | network-access-management:trust-domains:wifi:read
    | **network-access-management:trust-domains:wifi.auxiliary:write** | Create or modify a service owner's Wi-Fi auxiliary Trust Domains | network-access-management:trust-domains:wifi.auxiliary:read<br />network-access-management:trust-domains:wifi:write
    | **network-access-management:trust-domains:thread:read** | Read the Thread credentials if they are the API provider's default or the requesting client formed the network
    | **network-access-management:trust-domains:thread:form** | Form a new Thread network, replacing the API provider's default Thread network if applicable, and modify or delete the existing network if created by the requesting client | network-access-management:trust-domains:thread:read
    | **network-access-management:trust-domains:thread.admin** | Read or write to any of the service owner's Thread networks | network-access-management:trust-domains:thread:form
    | **network-access-management:reboot-requests:read** | List a service owner's reboot requests created by the calling API client
    | **network-access-management:reboot-requests:write** | Create or modify a service owner's reboot request created by the calling API client | network-access-management:reboot-request:read

    ## General Usage
    This API is intended for creating, modifying, or deleting Trust Domains using the `/trust-domains` endpoints
    to build access detail configurations. The `/service-sites` endpoints are used for iterating over a service owner's
    locations. The exact location may be requested with an additional scope to assist with reconciling information about
    service sites when the API client operator has an existing relationship with the service owner. Similarly, the
    `/devices` endpoints are used for iterating over and configuring a service owner's devices.  The hardware address
    may be requested for the same purpose of reconciling information from another source (e.g., database, persons with
    physical device access, etc.).

    ## Comments for Network Operators
    The following comments are for Network Operators implementing this API.

    ### Auto-Deleting Trust Domains
    When a Trust Domain is not configured on any device the network configuration and its identifier SHOULD be
    auto-deleted.  API clients MUST not be expected to delete Trust Domains not configured on any device.

    ### Mesh Systems
    Mesh systems SHOULD be represented as a single device when implementing this API due to the undefined behavior of
    LAN connectivity across multiple devices with the same Trust Domain.  The recommendation is to use the gateway
    hardware address of the mesh system when exposing that field, though the hardware address of any node in the mesh
    may be used.  If an end-user replaces the equipment, all existing Trust Domains SHOULD be synced to the new
    device representing this mesh.  Alternatively, a synthetic hardware address may also be used if the specification
    for the address type allows.

    # Additional CAMARA error responses

    The list of error codes in this API specification is not exhaustive. Therefore the API specification may not document some non-mandatory error statuses as indicated in `CAMARA API Design Guide`.

    Please refer to the `CAMARA_common.yaml` of the Commonalities Release associated to this API version for a complete list of error responses. The applicable Commonalities Release can be identified in the `API Readiness Checklist` document associated to this API version.

    As a specific rule, error `501 - NOT_IMPLEMENTED` can be only a possible error response if it is explicitly documented in the API.

  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
  version: 0.1.0-alpha.1
  x-camara-commonalities: 0.6.0
  contact:
    email: sp-nam@lists.camaraproject.org

servers:
  - url: "{apiRoot}/network-access-management/v0"
    variables:
      apiRoot:
        default: http://localhost:9091
        description: API root, defined by the service provider, e.g. `api.example.com` or `api.example.com/somepath`

tags:
  - name: Trust Domains
    description: Operations to Create and Manage Trust Domains

paths:
  /trust-domains:
    post:
      tags:
        - Trust Domains
      summary: Create a new Trust Domain
      security:
        - openId:
            - network-access-management:trust-domains:write
      description: |
        Creates and returns the new Trust Domain.  Scopes impact the function and output of this endpoint. See the examples
        for various permutations.

        **Required Scopes:**
        - **one of**
          - `network-access-management:trust-domains:wifi:write`
          - `network-access-management:trust-domains:wifi.primary:write`
          - `network-access-management:trust-domains:wifi.auxiliary:write`
      operationId: createTrustDomain
      requestBody:
        description: Details of the Trust Domain to be created
        required: true
        content:
          application/json:
            schema:
              $ref: './Domain/TrustDomains.yaml#/components/schemas/TrustDomainCreate'
            examples:
              TrustDomainCreateWpa2Personal:
                $ref: './Domain/TrustDomains.yaml#/components/examples/TrustDomainCreateWpa2Personal'
              TrustDomainCreateInferredSsid:
                $ref: './Domain/TrustDomains.yaml#/components/examples/TrustDomainCreateInferredSsid'
              TrustDomainCreateThreadStructured:
                $ref: './Domain/TrustDomains.yaml#/components/examples/TrustDomainCreateThreadStructured'
              TrustDomainCreateEphemeral:
                $ref: './Domain/TrustDomains.yaml#/components/examples/TrustDomainCreateEphemeral'
              TrustDomainCreateQoSPolicies:
                $ref: './Domain/TrustDomains.yaml#/components/examples/TrustDomainCreateQoSPolicies'
      responses:
        '201':
          description: Trust Domain created successfully
          content:
            application/json:
              schema:
                $ref: './Domain/TrustDomains.yaml#/components/schemas/TrustDomain'
              examples:
                TrustDomainResponseWiFiThread:
                  $ref: './Domain/TrustDomains.yaml#/components/examples/TrustDomainResponseWiFiThread'
        '400':
          $ref: './Domain/Common.yaml#/components/responses/Generic400'
        '401':
          $ref: './Domain/Common.yaml#/components/responses/Generic401'
        '403':
          $ref: './Domain/Common.yaml#/components/responses/Generic403'
        '409':
          $ref: './Domain/Common.yaml#/components/responses/Generic409'
        '500':
          $ref: './Domain/Common.yaml#/components/responses/Generic500'

    get:
      tags:
        - Trust Domains
      summary: Get all Trust Domains associated with the service owner
      security:
        - openId:
            - network-access-management:trust-domains:read
      operationId: getTrustDomains
      description: "This endpoint returns a list of Trust Domains associated with the service owner, each containing details about the network configurations and policies defined within them."
      responses:

        "200":
          description: Contains information about all trust domains
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "Domain/TrustDomains.yaml#/components/schemas/TrustDomain"
        "401":
          $ref: "./Domain/Common.yaml#/components/responses/Generic401"
        "403":
          $ref: "./Domain/Common.yaml#/components/responses/Generic403"
        "500":
          $ref: "./Domain/Common.yaml#/components/responses/Generic500"
        "503":
          $ref: "./Domain/Common.yaml#/components/responses/Generic503"

  /trust-domains/{trustDomainId}:
    parameters:
      - $ref: './Domain/TrustDomains.yaml#/components/parameters/trustDomainId'

    get:
      tags:
        - Trust Domains
      summary: Get a specific Trust Domain
      security:
        - openId:
            - network-access-management:trust-domains:read
      operationId: getTrustDomain
      description: |
        Returns the Trust Domain that matches the given ID, including its network configurations and policies. Scopes impact the output of this endpoint. See the examples for
        various permutations.

        **Required Scopes:**
        - **one of**
          - `network-access-management:trust-domains:wifi:read`
          - `network-access-management:trust-domains:wifi:write`
          - `network-access-management:trust-domains:wifi.primary:read`
          - `network-access-management:trust-domains:wifi.primary:write`
          - `network-access-management:trust-domains:wifi.auxiliary:read`
          - `network-access-management:trust-domains:wifi.auxiliary:write`

      responses:

        "200":
          description: Contains information about the specified trust domain
          content:
            application/json:
              schema:
                $ref: "./Domain/TrustDomains.yaml#/components/schemas/TrustDomain"
              examples:
                TrustDomainResponseBasic:
                  $ref: './Domain/TrustDomains.yaml#/components/examples/TrustDomainResponseBasic'
        "401":
          $ref: "./Domain/Common.yaml#/components/responses/Generic401"
        "403":
          $ref: "./Domain/Common.yaml#/components/responses/Generic403"
        "404":
          $ref: "./Domain/Common.yaml#/components/responses/Generic404"
        "500":
          $ref: "./Domain/Common.yaml#/components/responses/Generic500"
        "503":
          $ref: "./Domain/Common.yaml#/components/responses/Generic503"

    patch:
      tags:
        - Trust Domains
      summary: Update a specific Trust Domain
      security:
        -  openId:
            - network-access-management:trust-domains:write
      operationId: updateTrustDomain
      description: |
        Updates the Trust Domain, reconfigures any network access devices configured with the Trust Domain, and returns the Trust Domain that matches
        the given ID.  Scopes impact the output of this endpoint.  See the examples for various permutations.

        **Required Scopes:**
        - **one of**
          - `network-access-management:trust-domains:wifi:write`
          - `network-access-management:trust-domains:wifi.primary:write`
          - `network-access-management:trust-domains:wifi.auxiliary:write`

      requestBody:
        content:
          application/json:
            schema:
              $ref: "./Domain/TrustDomains.yaml#/components/schemas/TrustDomainUpdate"
        required: true
      responses:
        "200":
          description: Contains information about the updated trust domain
          content:
            application/json:
              schema:
                $ref: "./Domain/TrustDomains.yaml#/components/schemas/TrustDomain"

        "400":
          $ref: "./Domain/Common.yaml#/components/responses/Generic400"
        "401":
          $ref: "./Domain/Common.yaml#/components/responses/Generic401"
        "403":
          $ref: "./Domain/Common.yaml#/components/responses/Generic403"
        "404":
          $ref: "./Domain/Common.yaml#/components/responses/Generic404"
        "500":
          $ref: "./Domain/Common.yaml#/components/responses/Generic500"
        "503":
          $ref: "./Domain/Common.yaml#/components/responses/Generic503"

    delete:
      tags:
        -  Trust Domains
      summary: Delete a specific Trust Domain
      security:
        -  openId:
            - network-access-management:trust-domains:write
      operationId: deleteTrustDomain
      description: |
        Deletes the Trust Domain and removes the configuration from any network access devices configured with the Trust Domain that matches the
        given ID.

        **Required Scopes:**
        - **one of**
          - `network-access-management:trust-domains:wifi:write`
          - `network-access-management:trust-domains:wifi.primary:write`
          - `network-access-management:trust-domains:wifi.auxiliary:write`
      responses:
        "204":
          description: Trust Domain deleted successfully
        "401":
          $ref: "./Domain/Common.yaml#/components/responses/Generic401"
        "403":
          $ref: "./Domain/Common.yaml#/components/responses/Generic403"
        "404":
          $ref: "./Domain/Common.yaml#/components/responses/Generic404"
        "500":
          $ref: "./Domain/Common.yaml#/components/responses/Generic500"
        "503":
          $ref: "./Domain/Common.yaml#/components/responses/Generic503"


components:
  securitySchemes:
    openId:
      $ref: './Domain/Common.yaml#/components/securitySchemes/openId'